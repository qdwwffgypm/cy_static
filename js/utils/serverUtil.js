!function(a,b){if("undefined"!=typeof module)require("./ajaxUtil"),require("../libs/cache"),module.exports=b(a);else if(b(a),"function"==typeof define&&(define.amd||define.cmd)){var c="//"+(/ppppoints.com/.test(document.domain)?"j.ppppoints.com":"j.changyoyo.com")+"/static/js/";requirejs.config({paths:{cache:c+"libs/cache",ajaxUtil:c+"utils/ajaxUtil"}}),define("serverUtil",["cache","ajaxUtil"],function(){return b(a)})}}(window||this,function(a){function b(){}var c,d;return!a.CY&&(a.CY={}),a.CY.serverUtil?a.CY.serverUtil:(c="m.changyoyo.com"==document.domain,b.cssUrl=c?"//css.changyoyo.com":"//css.ppppoints.com",b.jsUrl=c?"//js.changyoyo.com":"//js.ppppoints.com",b.imgUrl=c?"//image.changyoyo.com":"//"+location.host,d=function(a){return Object.prototype.toString.call(a).split(/\s(\w+)/)[1].toLowerCase()},b.getCurrTime=function(b){var d,e,f,c,g;return b=b||function(){},c=this,d=function(){return new Date(+new Date+c.__daTime)},e=function(){var a=b;return new Promise(function(c){b=function(b){a(b),c(b)}})},c.__isSynchTime?(b(d()),new Promise(function(a){a(d())})):c.__timeCallbacks?(g=e(),c.__timeCallbacks.push(b),g):(c.__timeCallbacks=[b],f=function(){var a=d();c.__timeCallbacks.map(function(b){setTimeout(function(){b(a)},0)}),delete c.__timeCallbacks},a.CY.ajaxUtil.loadData("/pointgate/common/getServerDate",{}).then(function(a){return"0000"===a.respCode&&(c.__daTime=a.data.serverDate-+new Date,c.__isSynchTime=!0,f()),d()}))},b.loadRecommend=function(b,c){var i,j,h,k,l,m,e=this,f=",",g="all";for(a.CY.cache.__items=a.CY.cache.__items||{},"function"===d(b.keyIds)&&(c=b.keyIds,b.keyIds=[]),"string"===d(b.keyIds)&&(b.keyIds=b.keyIds.split(f),c=c||function(){}),b.cache&&(a.CY.cache.runClear(),b.cache=Number(b.cache)),h=b.keyIds.length-1;h>=0;h--)if(i=b.keyIds[h],j=i+f,a.CY.cache.get(i)){if(i===g){k=a.CY.cache.get(i)||{};for(l in k)k.hasOwnProperty(l)&&"[object Array]"===Object.prototype.toString.call(k[l])&&c(i,k[l])}else c(i,a.CY.cache.get(i));b.keyIds.splice(h,1)}else a.CY.cache.__items[j]?(a.CY.cache.__items[j].push(c),b.keyIds.splice(h,1)):a.CY.cache.__items[j]=[c];if(b.keyIds.length&&(!b.onSend||b.onSend.call(e,b,c)!==!1)){for(h=b.keyIds.length-1;h>=0;h--)b.keyIds[h]===g&&b.keyIds.splice(h,1);m={keyId:b.keyIds.join(f)},b.login_token&&(m.login_token=b.login_token),a.CY.ajaxUtil.loadData(b.url||"/pointgate/service/position/newRecommend",{method:"POST",body:m}).then(function(c){var h,i,d,j,k,l,m;if(b.onAfter&&b.onAfter.call(e,b,c),"0000"===c.respCode){for(d=b.keyIds.length-1;d>=0;d--)h=b.keyIds[d],i=h+f,j=c.data[h]||[],j.sort(function(a,b){return b.sort-a.sort}),a.CY.cache.set(h,j,b.cache),(a.CY.cache.__items[i]||[]).forEach(function(a){a(h,j)}),delete a.CY.cache.__items[i],delete c.data[h];k={};for(m in c.data)c.data.hasOwnProperty(m)&&"[object Array]"===Object.prototype.toString.call(c.data[m])&&(l=!0,h=g,i=h+f,j=c.data[m]||[],j.sort(function(a,b){return b.sort-a.sort}),k[m]=j,a.CY.cache.__items[i].forEach(function(a){a(h,j)}),delete c.data[m]);l&&a.CY.cache.set(g,k,b.cache)}})}},a.CY.serverUtil=b,b)});